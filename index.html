<!DOCTYPE html>
<html>
  <head>
    <title>Anas Abdulgafoor </title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="https://assets.taponn.digital/web-app/index-min.css" /> -->
    <link rel="stylesheet" href="tapo.css" />
    <link rel="icon" type="image/x-icon" href="https://assets.taponn.digital/web-app/taponn-logo.ico" />
  </head>

  <body>
    <div>
      <main id="product-data-1" class="main">
        <div class="profile-card">
          <img src="https://assets.taponn.digital/65353e3b2da888004d9d752c/businessCover/_1697989022551.jpg" alt="Avatar" />
        </div>
        <div class="content-card">
          <div class="profile-image">
            <img class="profile-avatar" src="https://assets.taponn.digital/65353e3b2da888004d9d752c/profileImage/_1697992718298.jpg?w=300&h=300" alt="Avatar" />
            <img class="company-logo" src="https://assets.taponn.digital/65353e3b2da888004d9d752c/businessLogo/_1697989023193.jpg" alt="Avatar" />
          </div>
          <div class="profile-details">
            <div class="username">
              <p>Anas Abdulgafoor </p>
            </div>
            <div class="designation">
              <p>Managing Director <span> @ Neptunemark </span></p>
            </div>
            <div class="personalBio">
              <p></p>
            </div>
            <div class="profile-button" id="profile-button">
              <button class="connect-btn" onclick="openModal('modal-1')">connect with me</button>
              <button class="connect-btn" onclick="saveData()">Save to phone</button>
            </div>
          </div>
        </div>

        <div class="social-media-links">
          <div class="row1">
            		<div class="wrapper">
            		<img src="https://storage.googleapis.com/bucket_icons/phone.png" alt="Phone" onclick="sendInsights('Phone',`65353f882da888004d9d7535`); window.open('tel:+919539963413','_self');" />
              <span class="alt-text">phone</span></div>
            		<div class="wrapper">
            		<img src="https://storage.googleapis.com/bucket_icons/email.png" alt="Email" onclick="sendInsights('Email',`65353fa02da888004d9d7537`); window.open('mailto:anas@neptunemark.com','_self');" />
              <span class="alt-text">Email</span></div>
            		<div class="wrapper">
            		<img src="https://storage.googleapis.com/bucket_icons/website.png" alt="Website" onclick="sendInsights('Website',`65353fb22da888004d9d753a`); window.open('https://www. Neptunemark.com','_self');" />
              <span class="alt-text">Website</span></div>
            		<div class="wrapper">
            		<img src="https://storage.googleapis.com/bucket_icons/whatsapp.png" alt="WhatsApp" onclick="sendInsights('WhatsApp',`65353fc12da888004d9d753c`); window.open('https://api.whatsapp.com/send?phone&#x3D;918590305060','_self');" />
              <span class="alt-text">WhatsApp</span></div>
            		<div class="wrapper">
            		<img src="https://storage.googleapis.com/bucket_icons/instagram.png" alt="Instagram" onclick="sendInsights('Instagram',`653540012da888004d9d753e`); window.open('https://instagram.com/anas.abdulgafoor','_self');" />
              <span class="alt-text">Instagram</span></div>
            		<div class="wrapper">
            		<img src="https://assets.taponn.digital/app-icons/google-review.png" alt="Google Reviews" onclick="sendInsights('Google Reviews',`653542e12da888004d9d7552`); window.open('Neptune mark','_self');" />
              <span class="alt-text">Google Reviews</span></div>
          
          </div>

          <div class="get-button">
            <a href="https://neptunemark.com"><button>powerd by</button></a>
          </div>
        </div>

        
      </main>
    </div>
    
     <div id="modal-1" class="modal-container">
          <div class="modal-body">
            <span class="close-modal" onclick="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
                <path d="M12.0007 10.5865L16.9504 5.63672L18.3646 7.05093L13.4149 12.0007L18.3646 16.9504L16.9504 18.3646L12.0007 13.4149L7.05093 18.3646L5.63672 16.9504L10.5865 12.0007L5.63672 7.05093L7.05093 5.63672L12.0007 10.5865Z"></path>
              </svg>
            </span>
            <div class="modal-header">
              <h3>Share your info with Anas Abdulgafoor </h3>
            </div>
            <div class="divider"></div>

            <form id="form" autocomplete="on">
              <div class="input-group">
                <input required id="firstName" type="text" name="firstName" autocomplete="name" class="input" />
                <label for="firstName" class="user-label">Name</label>
              </div>
              
              <div class="input-group">
                <input required id="cardNumber" type="text" name="cardNumber" autocomplete="tel" class="input" />
                <label for="cardNumber" class="user-label">Mobile</label>
              </div>
              
              <div class="input-group">
                <input required id="cardEmailAddress" type="text" name="cardEmailAddress" autocomplete="email" class="input" />
                <label for="cardNumber" class="user-label">Email</label>
              </div>
              
              <div class="input-group">
                <input id="cardjobTitle" type="text" name="cardjobTitle" autocomplete="organization-title" class="input" />
                <label for="cardjobTitle" class="user-label">Designation</label>
              </div>
              
              <div class="input-group">
                <input id="cardWebsite" type="text" name="cardWebsite" autocomplete="organization" class="input" />
                <label for="cardWebsite" class="user-label">Company</label>
              </div>
              
              <div class="input-group">
                <input id="personalBio" type="text" name="personalBio" autocomplete="bio" class="input" />
                <label for="personalBio" class="user-label">Note</label>
              </div>

                <input id="cardType" type="hidden" name="cardType" value="userFormInfo" />

              <div type="submit" onsubmit="onFormSubmit()" class="connect-button">
                <button id="submitButton">Connect</button>
              </div>
            </form>
            <span class="error_message" id="error_message"></span>
            <div class="disclaimer">
              <p>Taponn does not sell or share your data</p>
            </div>
          </div>
        </div> 
  </body>
  <script>
    // open modal by id
function openModal(id) {
  document.getElementById(id).classList.add("open");
  document.body.classList.add("modal-open");
}

// close currently open modal
function closeModal() {
  document.querySelector(".modal-container.open").classList.remove("open");
  document.body.classList.remove("modal-open");
}
function setFaviconFromProfilePicture() {
  const tempCanvas = document.createElement('canvas');
  tempCanvas.width = 100;
  tempCanvas.height = 100;
  const tempCtx = tempCanvas.getContext('2d');
  const img = new Image();
  img.crossOrigin = 'Anonymous';
  // Find the profile-avatar image tag with the class
  const profileAvatarImg = document.querySelector('img.profile-avatar');

  if (profileAvatarImg) {
    img.onload = function() {
      tempCtx.beginPath();
      tempCtx.arc(tempCanvas.width / 2, tempCanvas.height / 2, tempCanvas.width / 2, 0, Math.PI * 2);
      tempCtx.closePath();
      tempCtx.clip();

      tempCtx.drawImage(img, 0, 0, tempCanvas.width, tempCanvas.height);

      const dataURL = tempCanvas.toDataURL('image/png');
      const favicon = document.querySelector('link[rel="icon"]');
      favicon.href = dataURL;
    };

    // Load the image from the src attribute of the profile-avatar img tag
    img.src = profileAvatarImg.src;
  }
}
    
// close modals on background click
window.addEventListener("load", function () {
  document.addEventListener("click", (event) => {
    if (event.target.classList.contains("modal-container")) {
      closeModal();
    }
  });
  
});
window.onload = function () {
  var canonical_identifier = `65353e3b2da888004d9d752c`
  if(canonical_identifier != "64e4a68bc6c3a8004d5dee20"){
    document.getElementById("profile-button").innerHTML=`<button class="connect-btn" onclick="openModal('modal-1')">connect with me</button>
              <button class="connect-btn" onclick="saveData()">Save to phone</button>`;
    document.getElementById("submitButton").innerHTML="Connect";
    //setTimeout(function () {
      //openModal("modal-1");
    //}, 10000);
  }else{
    document.getElementById("profile-button").innerHTML=`<button class="connect-btn" onclick="openModal('modal-1')">Register</button>`;
    document.getElementById("submitButton").innerHTML="Register Now";
    setTimeout(function () {
      openModal("modal-1");
    }, 0);
  }
  const container = document.querySelector('.profile-card');
  const img = container.querySelector('img');
  if (img.clientHeight > 212) {
    const margin = (img.clientHeight - 212) / 2;
    img.style.marginTop = `-${margin}px`;
  }
  setFaviconFromProfilePicture();
};
function showError(message) {
  document.getElementById("error_message").style.display = 'block';
  document.getElementById("error_message").innerHTML = message;
 setTimeout (function(){   document.getElementById("error_message").style.display = 'none';document.getElementById("error_message").innerHTML='';},2500)
}
function convertImageToBase64() {
  // Find the image element with class "profile-avatar"
  const imageElement = document.querySelector('.profile-avatar');

  if (imageElement) {
    const imageUrl = imageElement.src;

    // Create an HTML canvas element
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');

    // Create an image element
    const image = new Image();

    // Set the crossOrigin property to "Anonymous" to avoid CORS issues
    image.crossOrigin = 'Anonymous';

    return new Promise((resolve, reject) => {
      // When the image is loaded, draw it on the canvas
      image.onload = function() {
        try {
          canvas.width = 96;
          canvas.height = 96;
          context.drawImage(image, 0, 0, 96, 96);

          // Get the base64 string from the canvas
          const base64String = canvas.toDataURL().split(',')[1];;
          resolve(base64String);
        } catch (error) {
          console.log(error)
        }
      };

      image.onerror = function() {
        reject('');
      };

      // Set the source of the image to the image URL
      image.src = imageUrl;
    });
  } else {
    return Promise.reject('');
  }
}
// Form Handling
let form = document.querySelector("#form");
form.addEventListener("submit", onFormSubmit);

function onFormSubmit(event) {
  
  event.preventDefault();
  const data = new FormData(event.target);
  const formdata = JSON.stringify(Object.fromEntries(data.entries()));

  fetch(
    `https://api.taponn.digital/users/business-lists-without-app?profilename=tpo686267`,
    {
      method: "post",
      headers: {
        "Content-Type": "application/json",
      },
      body: formdata,
    }
  )
    .then((res) => 
      res.json()
    )
    .then((data)=>
      console.log(data)
    )
    .then(()=>closeModal())
    .catch((err) => {
      console.log(err);
      showError("Unable to save information. Please try again");
    });
}
function saveData(event) {
   var phoneList = "";
  var emailList = "";
  var personalBio = document.getElementsByClassName("personalBio")[0].getElementsByTagName("p")[0].innerHTML;
  personalBio = personalBio.replace(/(?:\r\n|\r|\n)/g, '\\n');
  var row1 = document.getElementsByClassName("row1")[0];
  var childDivs = Array.from(row1.querySelectorAll(".wrapper"));
  childDivs.forEach(function (childDiv){
    var altText = childDiv.querySelector("img").getAttribute("alt");
    if(altText === "Phone"){
      var onClickAttr = childDiv.querySelector("img").getAttribute("onClick");
      var phoneNumber = onClickAttr.match(/tel:(\+?\d+)/);
      if(phoneNumber){
        phoneList += "\nTEL;TYPE=work,voice:"
        phoneList += phoneNumber[1] 
      }
    }
    if(altText === "Email"){
      var onClickAttr = childDiv.querySelector("img").getAttribute("onClick");
      var email = onClickAttr.match(/mailto:([^'"]+)/);
      if(email){
        emailList += "\nEMAIL:"
        emailList += email[1] 
      }
    }
  });
   convertImageToBase64()
  .then((base64String) => {
    // create a vcard file
    var vcard =
      "BEGIN:VCARD\nVERSION:3.0\nFN:" +
      "Anas Abdulgafoor " +
      "\nN:;" +
      "Anas Abdulgafoor " +
      phoneList +
      "\nTITLE:" +
      "Managing Director " +
      "\nURL;TYPE=TapOnn - Digital Business Card:" +
      `https://taponn.me/tpo686267` +
      emailList +
      "\nORG:" +
      "Neptunemark " +
      "\nPHOTO;ENCODING=BASE64:" +
      base64String +
      "\nNOTE:" +
      personalBio +
      "\nEND:VCARD";
    var blob = new Blob([vcard], { type: "text/vcard" });
    var url = URL.createObjectURL(blob);

    const newLink = document.createElement("a");
    newLink.download = "Anas Abdulgafoor " + ".vcf";
    newLink.textContent = "Anas Abdulgafoor ";
    newLink.href = url;

    newLink.click();
   })
  .catch((error) => {
    // Handle errors
    console.log(error);
    showError("Unable to download vCard file. Please try again");
  });
}
function sendInsights(type,id){
  var myHeaders = new Headers();
  myHeaders.append("accept", "application/json");

  var requestOptions = {
    method: 'POST',
    headers: myHeaders,
    redirect: 'follow'
  };

  fetch("https://api.taponn.digital/users/insights?profileId="+"65353e3b2da888004d9d752c"+"&datalistId="+id, requestOptions)
    .then(response => response.text())
    .then(result => console.log(result))
    .catch(error => console.log('error', error));
}
  </script>
</html>
